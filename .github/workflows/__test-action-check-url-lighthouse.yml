name: Internal - Tests for "check/url-lighthouse" action

on:
  workflow_call:

permissions:
  contents: read

jobs:
  tests:
    name: Tests for "check/url-lighthouse" action
    runs-on: ubuntu-latest
    steps:
      - name: Arrange - Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0

      - name: Act - Check URL Lighthouse
        id: check-url-lighthouse
        uses: ./actions/check/url-lighthouse
        with:
          url: "https://hoverkraft-tech.github.io/ci-github-publish/"

      - name: Assert - Check report summary output
        env:
          REPORT_SUMMARY: ${{ steps.check-url-lighthouse.outputs.report-summary }}
        run: |
          if [ -z "$REPORT_SUMMARY" ]; then
            echo "The report summary is empty."
            exit 1
          fi

          echo "Report Summary:"
          echo -e "$REPORT_SUMMARY"

          if [[ "$REPORT_SUMMARY" != *"performance"* ]]; then
            echo "The report summary does not contain 'performance'."
            exit 1
          fi
