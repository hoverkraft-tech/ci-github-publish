name: Build a Jekyll site
description: |
  This action builds a Jekyll site from the source files.
author: hoverkraft
branding:
  icon: layers
  color: blue

inputs:
  theme:
    description: "The Jekyll theme to use for the site."
    required: false
    default: "jekyll-theme-cayman"
  pages:
    description: "The Jekyll pages path to build."
    required: false

outputs:
  build-path:
    description: "The path to the built site assets."
    value: "${{ steps.prepare-site.outputs.jekyll-destination }}"

runs:
  using: "composite"
  steps:
    - id: prepare-site
      uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
      with:
        script: |
          const path = require('path');
          const prepareSite = require(path.join(process.env.GITHUB_ACTION_PATH, 'prepare-site.js'));
          await prepareSite({
            core,
            io,
            glob,
            inputs: {
              theme: ${{ toJson(inputs.theme) }},
              pages: ${{ toJson(inputs.pages) }}
            }
          });

    - uses: actions/configure-pages@983d7736d9b0ae728b81ab479565c72886d7745b # v5.0.0

    - name: Build Jekyll site
      uses: actions/jekyll-build-pages@44a6e6beabd48582f863aeeb6cb2151cc1716697 # v1.0.13
      with:
        source: ${{ steps.prepare-site.outputs.jekyll-source }}
        destination: ${{ steps.prepare-site.outputs.jekyll-destination }}

    - shell: bash
      run: sudo chown -R $(whoami) "${{ steps.prepare-site.outputs.jekyll-destination }}"
